services:
  - name: goalsniper
    installCommand: pip install -r requirements.txt
    startCommand: startCommand: gunicorn main:app --bind 0.0.0.0:$PORT --workers 1 -k gthread --threads 8 --timeout 180 --access-logfile -
    env:
      PYTHONUNBUFFERED: "1"
      PYTHON_VERSION: "3.11"
      TZ: "Europe/Berlin"

    healthcheck:
      path: /
      interval: 10
      timeout: 5
      retries: 12

    variables:
      # --- Required secrets ---
      - key: DATABASE_URL           # postgres://user:pass@host:port/db
        required: true
      - key: API_KEY                # API-Football key
        required: true
      - key: TELEGRAM_BOT_TOKEN
        required: false
      - key: TELEGRAM_CHAT_ID
        required: false

      # --- Security ---
      - key: ADMIN_API_KEY
        required: false

      # --- Toggles / scheduling (these ARE used by your code) ---
      - key: RUN_SCHEDULER
        value: "1"
      - key: TRAIN_ENABLE
        value: "1"
      - key: AUTO_TUNE_ENABLE
        value: "1"
      - key: DAILY_ACCURACY_DIGEST_ENABLE
        value: "1"
      - key: DAILY_ACCURACY_HOUR
        value: "8"
      - key: DAILY_ACCURACY_MINUTE
        value: "0"
      - key: MOTD_ENABLE
        value: "1"
      - key: MOTD_HOUR
        value: "10"
      - key: MOTD_MINUTE
        value: "00"
      - key: SCAN_INTERVAL_SEC
        value: "300"
      - key: BACKFILL_EVERY_MIN
        value: "15"

      # --- Odds gating / EV (optional; your code supports these) ---
      - key: MIN_ODDS_OU
        value: "1.50"
      - key: MIN_ODDS_BTTS
        value: "1.50"
      - key: MIN_ODDS_1X2
        value: "1.50"
      - key: MAX_ODDS_ALL
        value: "20.0"
      - key: ODDS_CACHE_TTL_SEC
        value: "120"

      # --- Telegram behavior ---
      - key: SEND_MESSAGES          # set "false" to disable messages
        value: "true"
      - key: TELEGRAM_FAIL_COOLDOWN_SEC
        value: "60"

      # --- DB session safety (optional) ---
      - key: PG_STATEMENT_TIMEOUT_MS
        value: "15000"
      - key: PG_LOCK_TIMEOUT_MS
        value: "2000"
      - key: PG_IDLE_TX_TIMEOUT_MS
        value: "30000"
      - key: DB_SSLMODE_REQUIRE
        value: "1"
